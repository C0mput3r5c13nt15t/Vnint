"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5034],{5034:(J,d,o)=>{o.r(d),o.d(d,{ManageUsersPageModule:()=>G});var h=o(6019),l=o(9133),p=o(4522),a=o(6990),u=o(6431),A=o(6952),T=o(1855),e=o(3245),U=o(8481),_=o(2677),f=o(7094),Z=o(5729),v=o(6733),P=o(1516);function N(n,i){if(1&n&&(e.TgZ(0,"ion-select-option",8),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.s9C("value",t),e.xp6(1),e.Oqu(t)}}function S(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"ion-label",13),e.TgZ(2,"b"),e._uU(3),e.qZA(),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(3),e.hij("",t.name," ")}}function C(n,i){if(1&n){const t=e.EpF();e.ynx(0),e._UZ(1,"br"),e._UZ(2,"hr"),e.TgZ(3,"ion-row"),e.TgZ(4,"ion-chip",14),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2).$implicit;return e.oxw(2).convertToGuestAttendant(s.id)}),e._UZ(5,"ion-icon",15),e.TgZ(6,"ion-label"),e._uU(7,"Convert to guestAttendant"),e.qZA(),e.qZA(),e.qZA(),e.BQk()}}function M(n,i){if(1&n&&(e.ynx(0),e.YNc(1,C,8,0,"ng-container",7),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("ngIf","attendant"==t.name)}}function E(n,i){if(1&n&&(e.TgZ(0,"ion-card",1),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title",10),e._uU(3),e.qZA(),e.TgZ(4,"ion-card-subtitle"),e.YNc(5,S,4,1,"ng-container",11),e.TgZ(6,"ion-label",12),e._uU(7),e.ALo(8,"date"),e.ALo(9,"translate"),e.qZA(),e.YNc(10,M,2,1,"ng-container",11),e.qZA(),e.qZA(),e.qZA()),2&n){const t=i.$implicit;e.xp6(3),e.hij(" ",t.email," "),e.xp6(2),e.Q6J("ngForOf",t.roles),e.xp6(2),e.hij("- ",e.xi3(8,4,t.created_at,e.lcZ(9,7,"GENERAL.exactTimeDisplayFormat")),""),e.xp6(3),e.Q6J("ngForOf",t.roles)}}function O(n,i){if(1&n&&(e.ynx(0),e.YNc(1,E,11,9,"ion-card",9),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.filteredUsers)}}const x=[{path:"",component:(()=>{class n{constructor(t,r,s,c,m,g,I){this.userService=t,this.formBuilder=r,this.translate=s,this.alertController=c,this.alertService=m,this.rolesAndPermissionsService=g,this.errorService=I,this.users=[],this.filteredUsers=[],this.role_names=[]}ngOnInit(){this.searchUsersForm=this.formBuilder.group({roles:[""],email:[""]}),this.getRoles()}ionViewWillEnter(){this.getUsers(),this.getRoles()}getRoles(){this.rolesAndPermissionsService.getRoles().subscribe({error:t=>{this.errorService.errorOccurred.emit(t)},next:t=>{const r=t;this.role_names=[],this.role_names=r.roles.map(s=>s.name),this.searchUsersForm.patchValue({roles:r.roles.map(s=>s.name)})}})}getUsers(){this.userService.getUsers().subscribe({error:t=>{this.errorService.errorOccurred.emit(t)},next:t=>{const r=t;r.users.forEach(s=>{s.role_names=s.roles.map(c=>c.name)}),this.users=r.users,this.filteredUsers=r.users}})}searchUsers(){this.filteredUsers=[],this.users.forEach(t=>{this.arrayContainsArray(this.searchUsersForm.value.roles,t.role_names)&&this.similar(t.email,this.searchUsersForm.value.email)>.3&&this.filteredUsers.push(t)})}similar(t,r){if(!r)return 1;let s=0;const c=t.length>r.length?r.length:t.length,m=t.length<r.length?r.length:t.length;for(let g=0;g<c;g++)t[g]==r[g]&&s++;return s/m}arrayContainsArray(t,r){return r.every(function(s){return t.includes(s)})}convertToGuestAttendant(t){return(0,T.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.alertHeader"),message:this.translate.instant("ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.alertText"),buttons:[{cssClass:"cancel-text",text:this.translate.instant("GENERAL.POPUPS.cancel"),role:"cancel"},{text:this.translate.instant("ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.convertButton"),handler:()=>{this.userService.convertToGuestAttendant(t).subscribe({error:s=>{"missingPermissions"==s.error.message?this.alertService.alert("danger",this.translate.instant("GENERAL.ERRORS.missingPermissions"),"","lock-closed"):"userCanNotBeConverted"==s.error.message?this.alertService.alert("danger",this.translate.instant("ACTIONS.MANAGE_USERS.title"),"This user can not be converted to guestAttendant","lock-closed"):this.errorService.errorOccurred.emit(s)},next:s=>{const c=s;this.alertService.alert("success",this.translate.instant("ACTIONS.MANAGE_USERS.title"),c.message,"checkmark")},complete:()=>{this.getUsers()}})}}]})).present()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(U.K),e.Y36(l.qu),e.Y36(u.sK),e.Y36(a.Br),e.Y36(_.c),e.Y36(f.$),e.Y36(Z.T))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-manage-users"]],decls:20,vars:16,consts:[[3,"title"],["color","light"],[1,"inside-card-grid"],[3,"formGroup"],["color","light","formControlName","email","showCancelButton","focus",3,"placeholder","ionChange"],["multiple","true","formControlName","roles",3,"okText","cancelText","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],["color","light",4,"ngFor","ngForOf"],[1,"user-email"],[4,"ngFor","ngForOf"],[1,"subtitle-labels"],["color","primary",1,"subtitle-labels"],[3,"click"],["name","sync"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-content"),e._UZ(1,"app-toolbar"),e.TgZ(2,"ion-grid"),e.TgZ(3,"ion-row"),e.TgZ(4,"ion-col"),e._UZ(5,"app-card-title-bar",0),e.ALo(6,"translate"),e.TgZ(7,"ion-card",1),e.TgZ(8,"ion-card-content"),e.TgZ(9,"ion-grid",2),e.TgZ(10,"ion-row"),e.TgZ(11,"ion-col"),e.TgZ(12,"form",3),e.TgZ(13,"ion-searchbar",4),e.NdJ("ionChange",function(){return r.searchUsers()}),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"ion-select",5),e.NdJ("ionChange",function(){return r.searchUsers()}),e.ALo(16,"translate"),e.ALo(17,"translate"),e.YNc(18,N,2,2,"ion-select-option",6),e.qZA(),e.qZA(),e.YNc(19,O,2,1,"ng-container",7),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(5),e.s9C("title",e.lcZ(6,8,"ACTIONS.MANAGE_USERS.title")),e.xp6(7),e.Q6J("formGroup",r.searchUsersForm),e.xp6(1),e.s9C("placeholder",e.lcZ(14,10,"ACTIONS.MANAGE_USERS.INPUT.searchUsersPlaceholder")),e.xp6(2),e.s9C("okText",e.lcZ(16,12,"GENERAL.POPUPS.ok")),e.s9C("cancelText",e.lcZ(17,14,"GENERAL.POPUPS.cancel")),e.s9C("placeholder",r.role_names),e.xp6(3),e.Q6J("ngForOf",r.role_names),e.xp6(1),e.Q6J("ngIf",r.users.length>0))},directives:[a.W2,v.n,a.jY,a.Nd,a.wI,P.$,a.PM,a.FN,l._Y,l.JL,l.sg,a.VI,a.j9,l.JJ,l.u,a.t9,a.QI,h.sg,h.O5,a.n0,a.Zi,a.Dq,a.tO,a.Q$,a.hM,a.gu],pipes:[u.X$,h.uU],styles:[".user-email[_ngcontent-%COMP%]{font-size:14pt}hr[_ngcontent-%COMP%]{background-color:var(--ion-color-step-550, #737373)}.subtitle-labels[_ngcontent-%COMP%]{font-size:12pt}"]}),n})()}];let R=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[A.Bz.forChild(x)],A.Bz]}),n})();var y=o(6453),F=o(6060);let G=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[h.ez,l.u5,a.Pc,R,y.K,l.UX,u.aw.forChild({loader:{provide:u.Zw,useFactory:F.p,deps:[p.eN]}})]]}),n})()}}]);