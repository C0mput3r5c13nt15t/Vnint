"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5034],{5034:(I,d,a)=>{a.r(d),a.d(d,{ManageUsersPageModule:()=>F});var m=a(6019),l=a(9133),p=a(4522),o=a(6990),h=a(6431),A=a(6952),T=a(1855),e=a(3245),U=a(8481),_=a(2677),f=a(7094),Z=a(5729),v=a(6733),P=a(1516);function S(t,i){if(1&t&&(e.TgZ(0,"ion-select-option",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=i.$implicit;e.s9C("value",n),e.xp6(1),e.Oqu(e.lcZ(2,2,"GENERAL.USER_ROLES."+n))}}function N(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"ion-badge",12),e.TgZ(2,"ion-label",13),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.qZA(),e.BQk()),2&t){const n=i.$implicit;e.xp6(3),e.Oqu(e.lcZ(4,1,"GENERAL.USER_ROLES."+n.name))}}function E(t,i){if(1&t){const n=e.EpF();e.ynx(0),e._UZ(1,"br"),e._UZ(2,"hr"),e.TgZ(3,"ion-row"),e.TgZ(4,"ion-chip",14),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2).$implicit;return e.oxw(2).convertToGuestAttendant(s.id)}),e._UZ(5,"ion-icon",15),e.TgZ(6,"ion-label"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.qZA(),e.qZA(),e.BQk()}2&t&&(e.xp6(7),e.Oqu(e.lcZ(8,1,"ACTIONS.MANAGE_USERS.convertToGuestAttendant")))}function M(t,i){if(1&t&&(e.ynx(0),e.YNc(1,E,9,3,"ng-container",7),e.BQk()),2&t){const n=i.$implicit;e.xp6(1),e.Q6J("ngIf","attendant"==n.name)}}function O(t,i){if(1&t&&(e.TgZ(0,"ion-card",1),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title",10),e._uU(3),e.qZA(),e.TgZ(4,"ion-card-subtitle"),e.YNc(5,N,5,3,"ng-container",11),e.YNc(6,M,2,1,"ng-container",11),e.qZA(),e.qZA(),e.qZA()),2&t){const n=i.$implicit;e.xp6(3),e.hij(" ",n.email," "),e.xp6(2),e.Q6J("ngForOf",n.roles),e.xp6(1),e.Q6J("ngForOf",n.roles)}}function C(t,i){if(1&t&&(e.ynx(0),e.YNc(1,O,7,3,"ion-card",9),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.filteredUsers)}}const x=[{path:"",component:(()=>{class t{constructor(n,r,s,c,u,g,L){this.userService=n,this.formBuilder=r,this.translate=s,this.alertController=c,this.alertService=u,this.rolesAndPermissionsService=g,this.errorService=L,this.users=[],this.filteredUsers=[],this.role_names=[]}ngOnInit(){this.searchUsersForm=this.formBuilder.group({roles:[""],email:[""]}),this.getRoles()}ionViewWillEnter(){this.getUsers(),this.getRoles()}getRoles(){this.rolesAndPermissionsService.getRoles().subscribe({error:n=>{this.errorService.errorOccurred.emit(n)},next:n=>{const r=n;this.role_names=[],this.role_names=r.roles.map(s=>s.name),this.searchUsersForm.patchValue({roles:r.roles.map(s=>s.name)})}})}getUsers(){this.userService.getUsers().subscribe({error:n=>{this.errorService.errorOccurred.emit(n)},next:n=>{const r=n;r.users.forEach(s=>{s.role_names=s.roles.map(c=>c.name)}),this.users=r.users,this.filteredUsers=r.users}})}searchUsers(){this.filteredUsers=[],this.users.forEach(n=>{this.arrayContainsArray(this.searchUsersForm.value.roles,n.role_names)&&this.similar(n.email,this.searchUsersForm.value.email)>.3&&this.filteredUsers.push(n)})}similar(n,r){if(!r)return 1;let s=0;const c=n.length>r.length?r.length:n.length,u=n.length<r.length?r.length:n.length;for(let g=0;g<c;g++)n[g]==r[g]&&s++;return s/u}arrayContainsArray(n,r){return r.every(function(s){return n.includes(s)})}convertToGuestAttendant(n){return(0,T.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.translate.instant("ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.alertHeader"),message:this.translate.instant("ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.alertText"),buttons:[{cssClass:"cancel-text",text:this.translate.instant("GENERAL.POPUPS.cancel"),role:"cancel"},{text:this.translate.instant("ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.convertButton"),handler:()=>{this.userService.convertToGuestAttendant(n).subscribe({error:s=>{"missingPermissions"==s.error.message?this.alertService.alert("danger",this.translate.instant("GENERAL.ERRORS.missingPermissions"),"","lock-closed"):"userCanNotBeConverted"==s.error.message?this.alertService.alert("danger",this.translate.instant("ACTIONS.MANAGE_USERS.title"),"This user can not be converted to guestAttendant","lock-closed"):this.errorService.errorOccurred.emit(s)},next:s=>{const c=s;this.alertService.alert("success",this.translate.instant("ACTIONS.MANAGE_USERS.title"),c.message,"checkmark")},complete:()=>{this.getUsers()}})}}]})).present()})}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(U.K),e.Y36(l.qu),e.Y36(h.sK),e.Y36(o.Br),e.Y36(_.c),e.Y36(f.$),e.Y36(Z.T))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-manage-users"]],decls:20,vars:16,consts:[[3,"title"],["color","light"],[1,"inside-card-grid"],[3,"formGroup"],["color","light","formControlName","email","showCancelButton","focus",3,"placeholder","ionChange"],["interface","popover","multiple","true","formControlName","roles",3,"okText","cancelText","placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],["color","light",4,"ngFor","ngForOf"],[1,"user-email"],[4,"ngFor","ngForOf"],["color","primary"],[1,"white-font"],[3,"click"],["name","sync"]],template:function(n,r){1&n&&(e.TgZ(0,"ion-content"),e._UZ(1,"app-toolbar"),e.TgZ(2,"ion-grid"),e.TgZ(3,"ion-row"),e.TgZ(4,"ion-col"),e._UZ(5,"app-card-title-bar",0),e.ALo(6,"translate"),e.TgZ(7,"ion-card",1),e.TgZ(8,"ion-card-content"),e.TgZ(9,"ion-grid",2),e.TgZ(10,"ion-row"),e.TgZ(11,"ion-col"),e.TgZ(12,"form",3),e.TgZ(13,"ion-searchbar",4),e.NdJ("ionChange",function(){return r.searchUsers()}),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"ion-select",5),e.NdJ("ionChange",function(){return r.searchUsers()}),e.ALo(16,"translate"),e.ALo(17,"translate"),e.YNc(18,S,3,4,"ion-select-option",6),e.qZA(),e.qZA(),e.YNc(19,C,2,1,"ng-container",7),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(5),e.s9C("title",e.lcZ(6,8,"ACTIONS.MANAGE_USERS.title")),e.xp6(7),e.Q6J("formGroup",r.searchUsersForm),e.xp6(1),e.s9C("placeholder",e.lcZ(14,10,"ACTIONS.MANAGE_USERS.INPUT.searchUsersPlaceholder")),e.xp6(2),e.s9C("okText",e.lcZ(16,12,"GENERAL.POPUPS.ok")),e.s9C("cancelText",e.lcZ(17,14,"GENERAL.POPUPS.cancel")),e.s9C("placeholder",r.role_names),e.xp6(3),e.Q6J("ngForOf",r.role_names),e.xp6(1),e.Q6J("ngIf",r.users.length>0))},directives:[o.W2,v.n,o.jY,o.Nd,o.wI,P.$,o.PM,o.FN,l._Y,l.JL,l.sg,o.VI,o.j9,l.JJ,l.u,o.t9,o.QI,m.sg,m.O5,o.n0,o.Zi,o.Dq,o.tO,o.yp,o.Q$,o.hM,o.gu],pipes:[h.X$],styles:[".user-email[_ngcontent-%COMP%]{font-size:14pt}hr[_ngcontent-%COMP%]{background-color:var(--ion-color-step-550, #737373)}.subtitle-labels[_ngcontent-%COMP%]{font-size:12pt}ion-badge[_ngcontent-%COMP%]{margin-right:5px}ion-badge[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:normal!important}"]}),t})()}];let R=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[A.Bz.forChild(x)],A.Bz]}),t})();var G=a(6453),y=a(6060);let F=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[m.ez,l.u5,o.Pc,R,G.K,l.UX,h.aw.forChild({loader:{provide:h.Zw,useFactory:y.p,deps:[p.eN]}})]]}),t})()}}]);