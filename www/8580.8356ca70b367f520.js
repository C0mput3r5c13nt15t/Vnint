"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8580],{8580:(H,d,s)=>{s.r(d),s.d(d,{ManageSortingPageModule:()=>z});var p=s(6019),Z=s(9133),a=s(6990),u=s(6952),e=s(3245),_=s(6431),m=s(8481),A=s(5729),T=s(1856),f=s(2677),x=s(6733),h=s(1516);function S(t,o){1&t&&(e.TgZ(0,"ion-badge",16),e.TgZ(1,"ion-label",17),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"ACTIONS.VIEW_PROJECTS.unauthorized")))}function b(t,o){1&t&&(e.TgZ(0,"ion-badge",18),e.TgZ(1,"ion-label",17),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"ACTIONS.VIEW_PROJECTS.authorized")))}function q(t,o){if(1&t&&(e.TgZ(0,"ion-badge",16),e.TgZ(1,"ion-label",17),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(2),e.AsE("",n.participants.length-n.max_participants," ",e.lcZ(3,2,"ACTIONS.MANAGE_SORTING.tooMany"),"")}}function N(t,o){if(1&t&&(e.TgZ(0,"ion-badge",16),e.TgZ(1,"ion-label",17),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(2),e.AsE("",n.min_participants-n.participants.length," ",e.lcZ(3,2,"ACTIONS.MANAGE_SORTING.tooFew"),"")}}function O(t,o){1&t&&(e.TgZ(0,"ion-badge",18),e.TgZ(1,"ion-label",17),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"ACTIONS.MANAGE_SORTING.exact")))}function M(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"ion-item",19),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e._UZ(4,"ion-icon",20),e.qZA(),e.BQk()),2&t){const n=e.oxw().$implicit;e.xp6(3),e.Oqu(n.leader.email)}}function P(t,o){if(1&t&&(e.TgZ(0,"ion-item",19),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e._UZ(3,"ion-icon",20),e.qZA()),2&t){const n=o.$implicit;e.xp6(2),e.Oqu(n.email)}}function v(t,o){if(1&t&&(e.ynx(0),e.YNc(1,P,4,1,"ion-item",21),e.BQk()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",n.assistants)}}function I(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"ion-badge",22),e.TgZ(2,"ion-label",17),e._uU(3),e.qZA(),e.qZA(),e.BQk()),2&t){const n=o.$implicit,i=e.oxw(3).$implicit;e.xp6(1),e.Q6J("color",n.project_id==i.id?"success":"danger"),e.xp6(2),e.Oqu(n.project_id)}}function U(t,o){if(1&t&&(e.TgZ(0,"ion-select-option",27),e._uU(1),e.qZA()),2&t){const n=o.$implicit;e.Q6J("value",n.id),e.xp6(1),e.AsE("",n.id," - ",n.title,"")}}function j(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"ion-item",19),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-badge",22),e.TgZ(4,"ion-label",17),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.qZA(),e.YNc(7,I,4,2,"ng-container",23),e.TgZ(8,"ion-select",24),e.NdJ("ionChange",function(r){const c=e.CHM(n).$implicit;return e.oxw(4).moveUser(c,r)}),e.YNc(9,U,2,3,"ion-select-option",25),e.TgZ(10,"ion-select-option",26),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.qZA(),e.qZA()}if(2&t){const n=o.$implicit,i=e.oxw(2).$implicit,r=e.oxw(2);e.xp6(2),e.Oqu(n.email),e.xp6(1),e.Q6J("color",n.grade_level.grade_level>=i.min_grade&&n.grade_level.grade_level<=i.max_grade?"success":"danger"),e.xp6(2),e.AsE("",n.grade_level.grade_level,"",e.lcZ(6,7,"ACTIONS.MANAGE_SORTING.nthGrade"),""),e.xp6(2),e.Q6J("ngForOf",n.preferences),e.xp6(2),e.Q6J("ngForOf",r.projects),e.xp6(2),e.Oqu(e.lcZ(12,9,"ACTIONS.MANAGE_SORTING.removeFromProject"))}}function C(t,o){if(1&t&&(e.ynx(0),e.YNc(1,j,13,11,"ion-item",21),e.BQk()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",n.participants)}}function E(t,o){if(1&t&&(e.TgZ(0,"ion-card",1),e.TgZ(1,"ion-card-header"),e.TgZ(2,"ion-card-title"),e._uU(3),e.TgZ(4,"ion-reorder",10),e._UZ(5,"ion-icon",11),e.qZA(),e.qZA(),e.TgZ(6,"ion-card-subtitle"),e.TgZ(7,"ion-label",12),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"ion-label",13),e.TgZ(11,"b"),e._uU(12),e.qZA(),e.qZA(),e._UZ(13,"br"),e.TgZ(14,"ion-label",12),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"ion-label"),e.TgZ(18,"b"),e._uU(19),e.qZA(),e.qZA(),e.TgZ(20,"b"),e._uU(21,"-"),e.qZA(),e.TgZ(22,"ion-label"),e.TgZ(23,"b"),e._uU(24),e.qZA(),e.qZA(),e.qZA(),e.TgZ(25,"ion-card-subtitle"),e.YNc(26,S,4,3,"ion-badge",14),e.YNc(27,b,4,3,"ion-badge",15),e.YNc(28,q,4,4,"ion-badge",14),e.YNc(29,N,4,4,"ion-badge",14),e.YNc(30,O,4,3,"ion-badge",15),e.qZA(),e.qZA(),e.TgZ(31,"ion-card-content"),e.YNc(32,M,5,1,"ng-container",4),e.YNc(33,v,2,1,"ng-container",4),e.YNc(34,C,2,1,"ng-container",4),e.qZA(),e.qZA()),2&t){const n=o.$implicit;e.xp6(3),e.AsE(" ",n.id," - ",n.title," "),e.xp6(5),e.hij("",e.lcZ(9,15,"ACTIONS.VIEW_PROJECTS.by")," "),e.xp6(4),e.Oqu(n.leader.email),e.xp6(3),e.hij("",e.lcZ(16,17,"ACTIONS.VIEW_PROJECT.grade")," "),e.xp6(4),e.Oqu(n.min_grade),e.xp6(5),e.Oqu(n.max_grade),e.xp6(2),e.Q6J("ngIf",!n.authorized),e.xp6(1),e.Q6J("ngIf",n.authorized),e.xp6(1),e.Q6J("ngIf",n.participants.length>n.max_participants),e.xp6(1),e.Q6J("ngIf",n.participants.length<n.min_participants),e.xp6(1),e.Q6J("ngIf",n.participants.length<=n.max_participants&&n.participants.length>=n.min_participants),e.xp6(2),e.Q6J("ngIf",n.leader),e.xp6(1),e.Q6J("ngIf",n.assistants.length>0),e.xp6(1),e.Q6J("ngIf",n.participants.length>0)}}function J(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"ion-reorder-group",8),e.NdJ("ionItemReorder",function(r){return e.CHM(n),e.oxw().reorderProjects(r)}),e.YNc(1,E,35,19,"ion-card",9),e.qZA()}if(2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.projects)}}function Q(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"ion-badge",29),e.TgZ(2,"ion-label",17),e._uU(3),e.qZA(),e.qZA(),e.BQk()),2&t){const n=o.$implicit;e.xp6(3),e.Oqu(n.project_id)}}function R(t,o){if(1&t&&(e.TgZ(0,"ion-select-option",27),e._uU(1),e.qZA()),2&t){const n=o.$implicit;e.Q6J("value",n.id),e.xp6(1),e.AsE("",n.id," - ",n.title,"")}}function y(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"ion-item",19),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-badge",29),e.TgZ(4,"ion-label",17),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.qZA(),e.YNc(7,Q,4,1,"ng-container",23),e.TgZ(8,"ion-select",24),e.NdJ("ionChange",function(r){const c=e.CHM(n).$implicit;return e.oxw(2).moveUser(c,r)}),e.YNc(9,R,2,3,"ion-select-option",25),e.qZA(),e.qZA()}if(2&t){const n=o.$implicit,i=e.oxw(2);e.xp6(2),e.Oqu(n.email),e.xp6(3),e.AsE("",n.grade_level.grade_level,"",e.lcZ(6,5,"ACTIONS.MANAGE_SORTING.nthGrade"),""),e.xp6(2),e.Q6J("ngForOf",n.preferences),e.xp6(2),e.Q6J("ngForOf",i.projects)}}function Y(t,o){if(1&t&&(e.TgZ(0,"ion-col"),e.TgZ(1,"ion-card",28),e.TgZ(2,"ion-card-content"),e.TgZ(3,"ion-grid",2),e.TgZ(4,"ion-row"),e.TgZ(5,"ion-col"),e.ynx(6),e.YNc(7,y,10,7,"ion-item",21),e.BQk(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t){const n=e.oxw();e.xp6(7),e.Q6J("ngForOf",n.unsortedUsers)}}function F(t,o){if(1&t&&(e.TgZ(0,"ion-button",30),e._UZ(1,"ion-spinner",31),e.qZA()),2&t){const n=e.oxw();e.Q6J("disabled",n.isProcessed)}}function G(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"ion-button",32),e.NdJ("click",function(){return e.CHM(n),e.oxw().sortUsers()}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"ACTIONS.MANAGE_SORTING.applySorting")))}const w=[{path:"",component:(()=>{class t{constructor(n,i,r,g,c){this.translate=n,this.userService=i,this.errorService=r,this.projectService=g,this.alertService=c,this.unsortedUsers=[],this.projects=[],this.isProcessed=!1}ngOnInit(){this.getUsers(),this.getProjects()}getUsers(){this.userService.getUnsortedUsers().subscribe({error:n=>{this.errorService.errorOccurred.emit(n)},next:n=>{const i=n;i.users.forEach(r=>{r.role_names=r.roles.map(g=>g.name)}),this.unsortedUsers=i.users}})}getProjects(){this.projectService.getProjectsDetailed().subscribe({error:n=>{this.errorService.errorOccurred.emit(n)},next:n=>{this.projects=n.projects}})}moveUser(n,i){if(i.detail.value){const r=i.detail.value;for(let c=0;c<this.projects.length;c++){let l=this.projects[c].participants.findIndex(W=>W==n);-1!=l&&this.projects[c].participants.splice(l,1)}let g=this.unsortedUsers.findIndex(c=>c==n);-1!=g&&this.unsortedUsers.splice(g,1),0==r?this.unsortedUsers.push(n):this.projects.find(l=>l.id==r).participants.push(n)}}reorderProjects(n){const i=this.projects.splice(n.detail.from,1)[0];this.projects.splice(n.detail.to,0,i),n.detail.complete()}sortUsers(){if(0==this.isProcessed){this.isProcessed=!0;for(let n=0;n<this.unsortedUsers.length;n++)this.userService.makeParticipant(this.unsortedUsers[n].id,0).subscribe({error:i=>{"missingPermissions"==i.error.message?this.alertService.alert("danger",this.translate.instant("GENERAL.ERRORS.missingPermissions"),"","lock-closed"):"userCanNotBeConverted"==i.error.message?this.alertService.alert("danger",this.translate.instant("ACTIONS.MANAGE_USERS.title"),"This user can not be enlisted as a participant.","lock-closed"):this.errorService.errorOccurred.emit(i)},next:i=>{const r=i;this.alertService.alert("success",this.translate.instant("ACTIONS.MANAGE_USERS.title"),r.message,"checkmark")}});for(let n=0;n<this.projects.length;n++)for(let i=0;i<this.projects[n].participants.length;i++)this.userService.makeParticipant(this.projects[n].participants[i].id,this.projects[n].id).subscribe({error:r=>{"missingPermissions"==r.error.message?this.alertService.alert("danger",this.translate.instant("GENERAL.ERRORS.missingPermissions"),"","lock-closed"):"userCanNotBeConverted"==r.error.message?this.alertService.alert("danger",this.translate.instant("ACTIONS.MANAGE_USERS.title"),"This user can not be enlisted as a participant.","lock-closed"):this.errorService.errorOccurred.emit(r)},next:r=>{const g=r;this.alertService.alert("success",this.translate.instant("ACTIONS.MANAGE_USERS.title"),g.message,"checkmark")}});this.isProcessed=!1}}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(_.sK),e.Y36(m.K),e.Y36(A.T),e.Y36(T.Y),e.Y36(f.c))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-manage-sorting"]],decls:24,vars:7,consts:[[3,"title"],["color","light"],[1,"inside-card-grid"],["disabled","false",3,"ionItemReorder",4,"ngIf"],[4,"ngIf"],[1,"ion-padding"],["type","submit","class","ion-no-margin","expand","block","color","primary",3,"disabled",4,"ngIf"],["color","primary","expand","block","type","submit","class","ion-no-margin",3,"click",4,"ngIf"],["disabled","false",3,"ionItemReorder"],["color","light",4,"ngFor","ngForOf"],[2,"position","absolute","top","0","right","0"],["name","move"],[1,"subtitle-labels"],["color","primary",1,"subtitle-labels"],["color","danger",4,"ngIf"],["color","success",4,"ngIf"],["color","danger"],[1,"white-font"],["color","success"],["color","light","lines","none"],["size","small","name","star","slot","end","color","warning"],["color","light","lines","none",4,"ngFor","ngForOf"],[3,"color"],[4,"ngFor","ngForOf"],["interface","popover",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["value","0"],[3,"value"],[2,"min-width","600px"],["color","primary"],["type","submit","expand","block","color","primary",1,"ion-no-margin",3,"disabled"],["name","crescent"],["color","primary","expand","block","type","submit",1,"ion-no-margin",3,"click"]],template:function(n,i){1&n&&(e.TgZ(0,"ion-content"),e._UZ(1,"app-toolbar"),e.TgZ(2,"ion-grid"),e.TgZ(3,"ion-row"),e.TgZ(4,"ion-col"),e._UZ(5,"app-card-title-bar",0),e.ALo(6,"translate"),e.TgZ(7,"ion-card",1),e.TgZ(8,"ion-card-content"),e.TgZ(9,"ion-grid",2),e.TgZ(10,"ion-row"),e.TgZ(11,"ion-col"),e.YNc(12,J,2,1,"ion-reorder-group",3),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"ion-row"),e.YNc(14,Y,8,1,"ion-col",4),e.TgZ(15,"ion-col"),e.TgZ(16,"ion-card",1),e.TgZ(17,"ion-card-content"),e.TgZ(18,"ion-grid",2),e.TgZ(19,"ion-row"),e.TgZ(20,"ion-col"),e.TgZ(21,"div",5),e.YNc(22,F,2,1,"ion-button",6),e.YNc(23,G,3,3,"ion-button",7),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(5),e.s9C("title",e.lcZ(6,5,"ACTIONS.MANAGE_SORTING.title")),e.xp6(7),e.Q6J("ngIf",i.projects.length>0),e.xp6(2),e.Q6J("ngIf",i.unsortedUsers.length>0),e.xp6(8),e.Q6J("ngIf",i.isProcessed),e.xp6(1),e.Q6J("ngIf",!i.isProcessed))},directives:[a.W2,x.n,a.jY,a.Nd,a.wI,h.$,a.PM,a.FN,p.O5,a.oz,p.sg,a.Zi,a.Dq,a.Nh,a.gu,a.tO,a.Q$,a.yp,a.Ie,a.t9,a.QI,a.n0,a.YG,a.PQ],pipes:[_.X$],styles:[".subtitle-labels[_ngcontent-%COMP%]{display:inline}.long-description-label[_ngcontent-%COMP%]{margin:0;display:block;overflow:hidden;flex:1;text-overflow:ellipsis;white-space:nowrap}ion-badge[_ngcontent-%COMP%]{margin-right:5px}ion-badge[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:normal!important}"]}),t})()}];let $=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[u.Bz.forChild(w)],u.Bz]}),t})();var L=s(6453),k=s(6060),B=s(4522);let z=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[p.ez,Z.u5,a.Pc,$,L.K,_.aw.forChild({loader:{provide:_.Zw,useFactory:k.p,deps:[B.eN]}})]]}),t})()}}]);