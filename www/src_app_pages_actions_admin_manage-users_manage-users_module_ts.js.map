{"version":3,"file":"src_app_pages_actions_admin_manage-users_manage-users_module_ts.js","mappings":"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","sources":["./src/app/pages/actions/admin/manage-users/manage-users.page.html","./src/app/pages/actions/admin/manage-users/manage-users-routing.module.ts","./src/app/pages/actions/admin/manage-users/manage-users.module.ts","./src/app/pages/actions/admin/manage-users/manage-users.page.ts"],"sourcesContent":["export default \"<ion-content>\\n  <app-toolbar></app-toolbar>\\n  <ion-grid>\\n    <ion-row>\\n      <ion-col>\\n        <app-card-title-bar title=\\\"{{ 'ACTIONS.MANAGE_USERS.title' | translate }}\\\"></app-card-title-bar>\\n        <ion-card color=\\\"light\\\">\\n          <ion-card-content>\\n            <ion-grid class=\\\"inside-card-grid\\\">\\n              <ion-row>\\n                <ion-col>\\n                  <form [formGroup]=\\\"searchUsersForm\\\">\\n                    <ion-searchbar color=\\\"light\\\" (ionChange)=\\\"searchUsers()\\\" placeholder=\\\"{{ 'ACTIONS.MANAGE_USERS.INPUT.searchUsersPlaceholder' | translate }}\\\" formControlName=\\\"email\\\" showCancelButton=\\\"focus\\\"></ion-searchbar>\\n                    <ion-select (ionChange)=\\\"searchUsers()\\\" multiple=\\\"true\\\" formControlName=\\\"roles\\\" okText=\\\"{{ 'GENERAL.POPUPS.ok' | translate }}\\\" cancelText=\\\"{{ 'GENERAL.POPUPS.cancel' | translate }}\\\" placeholder=\\\"{{ role_names }}\\\">\\n                      <ion-select-option *ngFor=\\\"let role_name of role_names\\\" value=\\\"{{ role_name }}\\\">{{ role_name }}</ion-select-option>\\n                    </ion-select>\\n                  </form>\\n                  <ng-container *ngIf=\\\"users.length > 0\\\">\\n                    <ion-card *ngFor=\\\"let user of filteredUsers\\\" color=\\\"light\\\">\\n                      <ion-card-header>\\n                        <ion-card-title class=\\\"user-email\\\">\\n                          {{ user.email }}\\n                        </ion-card-title>\\n                        <ion-card-subtitle>\\n                          <ng-container *ngFor=\\\"let role of user.roles\\\">\\n                            <ion-label class=\\\"subtitle-labels\\\" color=\\\"primary\\\"><b>{{ role.name }} </b></ion-label>\\n                          </ng-container>\\n                          <ion-label class=\\\"subtitle-labels\\\">- {{ user.created_at | date :( 'GENERAL.exactTimeDisplayFormat' | translate ) }}</ion-label>\\n                          <ng-container *ngFor=\\\"let role of user.roles\\\">\\n                            <ng-container *ngIf=\\\"role.name == 'attendant'\\\">\\n                              <br>\\n                              <hr>\\n                              <ion-row>\\n                                <ion-chip (click)=\\\"convertToGuestAttendant(user.id)\\\">\\n                                  <ion-icon name=\\\"sync\\\"></ion-icon>\\n                                  <ion-label>Convert to guestAttendant</ion-label>\\n                                </ion-chip>\\n                              </ion-row>\\n                            </ng-container>\\n                          </ng-container>\\n                        </ion-card-subtitle>\\n                      </ion-card-header>\\n                    </ion-card>\\n                  </ng-container>\\n                </ion-col>\\n              </ion-row>\\n            </ion-grid>\\n          </ion-card-content>\\n        </ion-card>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ManageUsersPage } from './manage-users.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ManageUsersPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ManageUsersPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\n\nimport { ManageUsersPageRoutingModule } from './manage-users-routing.module';\nimport { ComponentsModule } from '../../../../components/components.module';\n\nimport { ManageUsersPage } from './manage-users.page';\n\nimport {createTranslateLoader} from \"src/app/app.module\";\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ManageUsersPageRoutingModule,\n    ComponentsModule,\n    ReactiveFormsModule,\n    TranslateModule.forChild({\n      loader: {\n        provide: TranslateLoader,\n        useFactory: createTranslateLoader,\n        deps: [HttpClient]\n      }\n    })\n  ],\n  declarations: [ManageUsersPage]\n})\nexport class ManageUsersPageModule {}\n","import {Component, OnInit} from '@angular/core';\nimport {FormBuilder, FormGroup} from '@angular/forms';\nimport {User} from 'src/app/interfaces/user';\nimport {ErrorService} from 'src/app/services/error.service';\nimport {RolesAndPermissionsService} from 'src/app/services/roles-and-permissions.service';\nimport {UserService} from 'src/app/services/user.service';\nimport {TranslateService} from \"@ngx-translate/core\";\nimport {AlertController} from \"@ionic/angular\";\nimport {AlertService} from \"../../../../services/alert.service\";\n\n@Component({\n  selector: 'app-manage-users',\n  templateUrl: './manage-users.page.html',\n  styleUrls: ['./manage-users.page.scss'],\n})\nexport class ManageUsersPage implements OnInit {\n  searchUsersForm: FormGroup;\n  users: User[] = [];\n  filteredUsers: User[] = [];\n  role_names: string[] = [];\n\n  constructor(private userService: UserService,\n              private formBuilder: FormBuilder,\n              private translate: TranslateService,\n              private alertController: AlertController,\n              private alertService: AlertService,\n              private rolesAndPermissionsService: RolesAndPermissionsService,\n              private errorService: ErrorService) { }\n\n  ngOnInit() {\n    this.searchUsersForm = this.formBuilder.group({\n      roles: [''],\n      email: [''],\n    });\n    this.getRoles();\n  }\n\n  ionViewWillEnter() {\n    this.getUsers();\n    this.getRoles();\n  }\n\n  getRoles() {\n    this.rolesAndPermissionsService.getRoles().subscribe({\n      error: error => {\n        this.errorService.errorOccurred.emit(error);\n      },\n      next: response => {\n        const resp: any = response;\n        this.role_names = [];\n        this.role_names = resp.roles.map(role => role.name)\n        this.searchUsersForm.patchValue({\n          roles: resp.roles.map(role => role.name),\n        });\n      }\n    });\n  }\n\n  getUsers() {\n    this.userService.getUsers().subscribe({\n      error: error => {\n        this.errorService.errorOccurred.emit(error);\n      },\n      next: response => {\n        const resp: any = response;\n        resp.users.forEach(user => {\n          user.role_names = user.roles.map(role => role.name);\n        });\n        this.users = resp.users;\n        this.filteredUsers = resp.users;\n      },\n    });\n  }\n\n  searchUsers() {\n    this.filteredUsers = [];\n    this.users.forEach(user => {\n      if (this.arrayContainsArray(this.searchUsersForm.value.roles, user.role_names) && this.similar(user.email, this.searchUsersForm.value.email) > 0.3) {\n        this.filteredUsers.push(user);\n      }\n    });\n  }\n\n  similar(email, input) {\n    if (!input) {\n      return 1;\n    }\n\n    let equivalency = 0;\n    const minLength = (email.length > input.length) ? input.length : email.length;\n    const maxLength = (email.length < input.length) ? input.length : email.length;\n    for(let i = 0; i < minLength; i++) {\n        if(email[i] == input[i]) {\n            equivalency++;\n        }\n    }\n    return equivalency / maxLength;\n  }\n\n  /**\n   * Returns true if the first specified array contains all elements\n   * from the second one. false otherwise.\n   *\n   * @param {array} superset\n   * @param {array} subset\n   *\n   * @returns {boolean}\n   */\n   arrayContainsArray (superset, subset) {\n      return subset.every(function (value) {\n        return (superset.includes(value));\n      });\n   }\n\n  async convertToGuestAttendant(id: number) {\n    const alert = await this.alertController.create({\n      header: this.translate.instant('ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.alertHeader'),\n      message: this.translate.instant('ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.alertText'),\n      buttons: [\n        {\n          cssClass: 'cancel-text',\n          text: this.translate.instant('GENERAL.POPUPS.cancel'),\n          role: 'cancel',\n        }, {\n          text: this.translate.instant('ACTIONS.MANAGE_USERS.CONVERT_TO_GUEST_ATTENDANT_POPUP.convertButton'),\n          handler: () => {\n            this.userService.convertToGuestAttendant(id).subscribe({\n              error: error => {\n                if (error.error.message == 'missingPermissions') {\n                  this.alertService.alert(\"danger\", this.translate.instant('GENERAL.ERRORS.missingPermissions'), '', 'lock-closed');\n                } else if (error.error.message == 'userCanNotBeConverted') {\n                  this.alertService.alert(\"danger\", this.translate.instant('ACTIONS.MANAGE_USERS.title'), 'This user can not be converted to guestAttendant', 'lock-closed');\n                } else {\n                  this.errorService.errorOccurred.emit(error);\n                }\n              },\n              next: response => {\n                const resp: any = response;\n                this.alertService.alert(\"success\", this.translate.instant('ACTIONS.MANAGE_USERS.title'), resp.message, \"checkmark\")\n              },\n              complete: () => {\n                this.getUsers();\n              },\n            });\n          }\n        }\n      ]\n    });\n    await alert.present();\n  }\n\n}\n"],"names":[],"sourceRoot":"webpack:///"}